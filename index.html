<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Itinerary Planning Tool</title>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
        <link rel="stylesheet" href="main.css">
    </head>
    <body>
        <div class="container">
            <div class="title">
                <h1 id="title"></h1>
                <a id="change-trail" data-toggle="modal" data-target="#changeTrail">change</a>
                <div class="modal fade" id="changeTrail" tabindex="-1" role="dialog" aria-labelledby="changeTrailLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                      <div class="modal-content">
                        <div class="modal-header">
                            <h4 class="modal-title change-trail-title">Change Trail</h4>
                        </div>
                        <div class="select-trail-modal modal-body">
                            <p class="select-trail-desc">To change the activated trail, you must upload the trail in the specified JSON format. All fields are required:</p>
                            <ul class="select-trail-desc">
                                <li><b>"name"</b>: trail name</li> 
                                <li><b>"length"</b>: trail length in the specified distance unit</li> 
                                <li><b>"unit"</b>: <b>"mi"</b> or <b>"km"</b></li> 
                                <li><b>"circuit"</b>: <b>true</b> if trail forms a loop, <b>false</b> otherwise</li> 
                                <li><b>"trailheads"</b>: list of trailheads ordered by <b>distance</b></li>
                                <li><b>"campsites"</b>: list of campsites ordered by <b>distance</b></li> 
                                <li><b>"name"</b> of trailheads and campsites</li>
                                <li><b>"distance"</b> of trailheads and campsites refers to their distance from <b>0</b></li>
                            </ul>
                            <div class="upload">
                                <div class="upload-trail">
                                    <h4 id="choose-file">Upload file: </h4>
                                    <input type="file" id="trailFile" name="filename" accept=".json" onchange="readFile(this)">
                                </div>
                                <div class="upload-btns">
                                    <!-- <button type="button" class="btn btn-primary" id="upload-trail-btn" data-dismiss="modal" onclick="changeTrail()">Upload</button> -->
                                    <span id="validJson"></span>
                                </div>                                
                            </div>
                            <h2><small>- OR -</small></h2>
                            <br>
                            <div class="template">
                                <h4>Fill out template: </h4>
                                <textarea id="json-template" cols=50 rows=26></textarea>
                                <br>
                                <div class="submit-btns">
                                    <button id="submit-trail-btn" type="button" class="btn btn-primary" onclick="submitTrail()">Submit</button>
                                    <button id="reset-trail-btn" type="button" class="btn btn-secondary" onclick="resetTemplate()">Reset</button>      
                                </div>
                            </div>
                        </div>
                      </div>
                    </div>
                  </div>
                <div class="distance-unit btn-group" data-toggle="buttons">
                    <label class="btn btn-default active">
                        <input type="radio" name="unit" id="mi" onChange="setUnit(this.id)" checked> mi
                    </label>
                    <label class="btn btn-default">
                        <input type="radio" name="unit" id="km" onChange="setUnit(this.id)"> km
                    </label>
                </div>
            </div>
            <h1><small>Itinerary Planning Tool</small></h1>
            <h2><small>Select the <strong>start and end trailheads</strong> with either <strong>days <u>or</u> <span id="unit1">miles</span> / day</strong>. If you have <strong>no preference</strong> on the start or end trailhead, select <strong>days <u>and</u> <span id="unit2">miles</span> / day</strong>. Set either value to <strong>0</strong> to defer to the other. </small><span class="info glyphicon glyphicon-info-sign" data-toggle="modal" data-target="#myModal"></span></h2>
            <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                      <h4 class="modal-title" id="myModalLabel">Trail Tuner</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            This planning tool is designed to generate a consistenly paced route given the information you provide. The more information entered, the more "accurate" the resulting itinerary will be. However, if you don't know (or care) about a specific field, feel free to leave it blank and the tool will determine a reasonable value.
                            <br>
                            <br>
                            <h4 class="modal-title" id="myModalLabel">Generate Route</h4>
                            <br>
                            Change the unit of distance to <b>mi</b> or <b>km</b> by switching the toggle in the upper right corner. Note: this does not simply switch the labels, it converts all <i>values</i> to the new unit.
                            <br>
                            <br>
                            Select the <b>Start</b> and <b>End Trailheads</b> from the dropdown lists, or let the tool select them for you by selecting <b>No Preference</b> at the top of each list.
                            <br>
                            <br>
                            Set <b>Days</b> and/or <b>Distance / Day</b> by typing the desired number in the input field. If you previously selected both a start and an end trailhead, then only one of these fields is applicable. Otherwise, you can set both. You can also opt to defer these fields by setting the value to "0". If neither are set, the tool defaults to a random ranged distance / day.
                            <br>
                            <br>
                            Set the <b>Start Date</b> when route will begin by clicking on the calendar.
                            <br>
                            <br>
                            If the trail is a loop, radio buttons labeled <b>Loop Direction</b> will be enabled. These inputs determine which direction your route will travel around the loop, either <b>Clockwise (CW)</b> or <b>Counter-clockwise (CCW)</b>.
                            <br>
                            <br>
                            The <b>Short hike-in</b> and <b>Short hike-out</b> checkboxes will force the resulting route to include a short day at the beginning or end of the route respectively. If <b>Short hike-in</b> is checked, the first night will always end at the first possible destination leading away from the start trailhead.
                            Likewise for <b>Short hike-out</b>, the final night will always be the last possible destination before reaching the end trailhead. The remaining days will still be generated according to normal inputs. These checkboxes are useful if, for example, you are starting your route late on a Friday after work and you do not have the entire day available.
                            <br>
                            <br>
                            When you are finished, click <b>Generate Route</b> to view your optimized itinerary. The distance of each day will be as consitent as possible. Keep in mind that due to unpredictable and irregular spacing of destinations, the resulting itinerary will rarely be "perfect". <b>Days</b> will always match (if set), but <b>Distance / Day</b> is simply used as a guideline to select the closest option. Rest assured that your route will be as similar to the provided input as statisically possible.  
                            <br>
                            <br>
                            Click <b>Reset</b> to clear the generated route and reset the inputs back to their default values.
                            <br>
                            <br>
                            <h4 class="modal-title" id="myModalLabel">Modify Route</h4>
                            <br>
                            For each day of the route, find the option to <b>Modify Destination</b>. Selecting the <span style="color:green;">green</span>, <i>closer destination</i> option will move the end point closer, shortening the current day and lengthening the next. Selecting the <span style="color:red;">red</span>, <i>further destination</i> option will move the end point further away, lengthening the current day and shortening the next. Modifications cannot be made to the start or end trailheads (for this, generate a new route). Furthermore, a route cannot go "backwards" by covering fewer than 0 miles on the current or subsequent day.
                            <br>
                            <br>
                            <h4 class="modal-title" id="myModalLabel">How It Works</h4>
                            <br>
                            Depending on the supplied input, a variety of algorithms are used to generate the itinerary. To generate a route for a certain number of days, the app looks at the daily mileage of all possibilities, calculates the standard deviation of each, and selects the lowest value. That is to say, it prioritizes the route with the most consistent daily mileage. So, at least from a purely mileage perspective, the optimal route is planned every time.
                            <br>
                            <br>
                            When fields are missing, the app does its best to fill in the gaps. Typically, this is done by finding all of the reasonable options, then selecting one at random. If you generate multiple routes with No Preference on the trailheads, you will likely see different outputs each time. Play around with different inputs to generate new routes!
                        </p>
                    </div>
                  </div>
                </div>
              </div>
            <div class="row">
                <div class="col-md-5">
                    <div class="trailhead-col">
                        <label for="start"><h2>Start Trailhead</h2></label>
                        <div class="hike-in-label">
                            <input class="half-day-input form-check-input" type="checkbox" id="hike-in" title="Hike-in to the first campsite from the start">
                            <label class="half-day-label form-check-label" for="hike-in" title="Hike-in to the first campsite from the start"><h2 class="half-day-label"><small>&nbsp;Short hike-in</small></h2></label>
                        </div>
                    </div>
                    <select id="start" class="form-control" onChange="onTrailheadsChange()">
                        <option value="0">No Preference</option>
                    </select>
                </div>
                <div class="col-md-5">
                    <div class="trailhead-col">
                        <label for="end"><h2>End Trailhead</h2></label>
                        <div class="hike-out-label">
                            <input class="half-day-input form-check-input" type="checkbox" id="hike-out" title="Hike-out from the last campsite before the end">
                            <label class="half-day-label form-check-label" for="hike-out" title="Hike-out from the last campsite before the end"><h2 class="half-day-label"><small>&nbsp;Short hike-out</small></h2></label>
                        </div>
                    </div>
                    <select id="end" class="form-control" onChange="onTrailheadsChange()">
                        <option value="0">No Preference</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label class="start-date" for="date"><h2><small><strong>Start Date</strong></small></h2></label>
                    <br>
                    <input type="date" id="start-date" name="start-date" value="2018-07-22">
                </div>
            </div>
            <div class="row align-items-center">
                <div class="col-md-5">                
                    <label for="days"><h2>Days</h2></label>
                    <input type="number" min="0" max="99" value="3" placeholder="" onChange="onDaysChange()" name="days" id="days" class="form-control">
                </div>
                <div class="col-md-5">                
                    <label for="distance"><h2><span id="unit3">Miles</span> / Day</h2></label>
                    <input type="number" min="0" max="99" value="" placeholder="Use Days" onChange="onDistancePerDayChange()" name="distance" id="distance" class="form-control">
                </div>
                <div class="col-sm-2">
                    <hr id="break">

                    <div id="loop-direction-form" class="form-check">
                        <label class="loop-direction form-check-label" title="Select which direction to travel around loop"><h2><small><strong class="loop-direction-label">Loop Direction</strong></small></h2></label>
                        <br>
                        <input class="form-check-input" type="radio" name="direction" id="cw" value="cw" title="Clockwise" onChange="onTrailheadsChange()" disabled>
                        <label class="loop-direction form-check-label" for="cw" title="Clockwise"><h2 class="loop-direction"><small class="loop-direction-label">&nbsp;CW<strong>&nbsp;↻</strong></small></h2></label>
                        <br>
                        <input class="form-check-input" type="radio" name="direction" id="ccw" value="ccw" title="Counter-clockwise" onChange="onTrailheadsChange()" disabled>
                        <label class="loop-direction form-check-label" for="ccw" title="Counter-clockwise"><h2 class="loop-direction"><small class="loop-direction-label">&nbsp;CCW<strong>&nbsp;↺</strong></small></h2></label>
                     </div>
                </div>
            </div>
            <br>
            <br>
            <div class="row">
                <div class="col-md-12"> 
                    <button class="btn btn-primary btn-lg btn-block" type="button" onclick="plan()">Generate Route</button>
                </div>
            </div>
            <br>
            <div class="row">
                <div class="col-md-12"> 
                    <button class="btn btn-warning btn-lg btn-block" type="button" onclick="updateGeoJSON()">Export Route</button>
                </div>
            </div>
            <br>
            <div class="row">
                <div class="col-md-12"> 
                    <button class="btn btn-secondary btn-lg btn-block" type="button" onclick="reset()">Reset</button>
                </div>
            </div>

            <br>
            <table class="table route-table table-striped" id="table">
                <thead class="thead-dark">
                <tr>
                    <th style="width: 3%" scope="col">#</th>
                    <th style="width: 10%" scope="col">Date</th>
                    <th style="width: 17%" scope="col">Origin</th>
                    <th style="width: 17%" scope="col">Destination</th>
                    <th class="right" style="width: 8%" scope="col">Daily</th>
                    <th class="right" style="width: 8%" scope="col">Total</th>
                    <th class="center" style="width: 37%" scope="col" colspan="2">Modify Destination</th>
                </tr>
                </thead>
                <tbody id="table-body">
                </tbody>
            </table>
            <br>
            <div id="map"></div>
        </div>
        <!-- <div class="container">
            <div class="row">
                <div class="col-md-12"> 
                    <button class="btn btn-primary btn-lg btn-block" type="button" onclick="">Share Route</button>
                </div>
            </div>
            <br>
        </div> -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.0/jquery.min.js" integrity="sha256-xNzN2a4ltkB44Mc/Jz3pT4iU1cmeR0FkXs4pru/JxaQ=" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>
        <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
        <script src="import.js"></script>
        <script src="changeTrail.js"></script>
        <script src="routeGen.js"></script>
        <script src="export.js"></script>
    </body>
</html>